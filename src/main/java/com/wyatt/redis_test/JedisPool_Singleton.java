package com.wyatt.redis_test;

import redis.clients.jedis.Jedis;
import redis.clients.jedis.JedisPool;
import redis.clients.jedis.JedisPoolConfig;

/**
 * Created by ASUS on 2018/11/4.
 */



//单例模式创建jedispool连接池
public class JedisPool_Singleton {

    private static volatile JedisPool jedisPool=null;

    private JedisPool_Singleton(){

    }

    //单例模式配置jedispool连接池
    public static JedisPool getJedisPoolInstance(){
        if (jedisPool==null){
            synchronized (JedisPool_Singleton.class){
                if (jedisPool==null){
                    JedisPoolConfig poolConfig=new JedisPoolConfig();
                    //设定连接上限
                    poolConfig.setMaxTotal(1000);
                    //提前预警报错,保证多少个空闲实例
                    poolConfig.setMaxIdle(32);
                    //向jedispool获取jedis实例的最大等待时间
                    poolConfig.setMaxWaitMillis(100*1000);
                    //获得一个实例时检测可用性，ping()，保证全都可用
                    poolConfig.setTestOnBorrow(true);

                    jedisPool=new JedisPool(poolConfig,"192.168.175.132",6380);
                }
            }
        }
        return jedisPool;
    }

    //关闭的是哪个jedispool的jedis实例
    public static void release(JedisPool jedisPool, Jedis jedis){
        if(jedis!=null){
            jedisPool.returnResourceObject(jedis);
        }

    }
}
