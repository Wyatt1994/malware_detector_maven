package com.wyatt.produce_consumer;

import org.omg.PortableServer.THREAD_POLICY_ID;

import java.util.Collections;
import java.util.LinkedList;
import java.util.List;
import java.util.concurrent.TimeUnit;

/**
 * Created by ASUS on 2018/11/20.
 */
public class Synchronize_Test<E> {
    private final LinkedList<E> list=new LinkedList();
    private final static int MAX=3;
    private int count=0;

    public static void main(String[] args) {
        Synchronize_Test container=new Synchronize_Test();
        for (int i = 0; i < 5; i++) {
            new Consumer(container).start();
            new Producer(container).start();
        }

    }
    public synchronized int getCount(){
        return this.count;
    }

    public synchronized E get(){
        while (list.size()==0){
            try {
                this.wait();
            } catch (InterruptedException e) {
                e.printStackTrace();
            }
        }

        E e=list.removeFirst();
        count--;
        this.notifyAll();
        return e;

    }

    public synchronized void put(E e){
        while (list.size()==MAX){
            try {
                this.wait();
            } catch (InterruptedException e1) {
                e1.printStackTrace();
            }
        }

        list.addLast(e);
        count++;
        this.notifyAll();
    }


}
class Producer<E> extends Thread{
    private Synchronize_Test queue;
    public Producer(Synchronize_Test queue){
        this.queue=queue;
    }

    @Override
    public void run() {
        String tmp="made by"+this.getName();
        System.out.println("producer_"+this.getName()+"生产了一个商品"+tmp);
        queue.put((E)tmp);
        try {
            TimeUnit.SECONDS.sleep(2);
        } catch (InterruptedException e) {
            // TODO Auto-generated catch block
            e.printStackTrace();
        }

    }
}

class Consumer<E> extends Thread{
    private Synchronize_Test queue;
    public Consumer(Synchronize_Test queue){
        this.queue=queue;
    }

    @Override
    public void run() {
        E e=(E)queue.get();
        System.out.println("consumer_"+this.getName()+"消费了一个商品"+e);
        try {
            TimeUnit.SECONDS.sleep(2);
        } catch (InterruptedException e1) {
            // TODO Auto-generated catch block
            e1.printStackTrace();
        }

    }
}

