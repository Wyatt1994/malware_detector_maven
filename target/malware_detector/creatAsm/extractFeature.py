from creatAsm.getFolderName import getFilename

__author__ = 'ASUS'
import csv
import os
def extractFeature(path,maldir):
    List = []
    malFeature = []
    with open(path) as file:
        reader = csv.reader(file)
        for line in reader:
            List.append((line[0],line[1],line[2]))
    malList = getFilename(maldir)
    for fileName in malList:
        filePath = maldir + '/' + fileName
        featureList = []
        ngramList = []
        signal2 = 0
        featureList.append(fileName)
        with open(filePath) as file:
            reader = csv.reader(file)
            for line in reader:
                if signal2 == 0:
                    signal2 = 1
                    continue
                ngramList.append((line[0],line[1],line[2],line[3]))
        for i in range(len(List)//2):
            signal = 0
            for line in ngramList:
                newList = list(line)
                if (newList[0],newList[1],newList[2]) == List[i]:
                    featureList.append(newList[3])
                    signal = 1
                    break
            if signal == 0:
                featureList.append('0')
        malFeature.append((featureList))
        #print('提取的opcode文件名:',fileName+'\n')
    with open('malfeature.csv','w',newline='') as file:
        try:
            if malFeature:
                print('正在生成opcode特征文件...\n')
            writer = csv.writer(file)
            for line in malFeature:
                writer.writerow(list(line))
            print('提取的opcode特征成功!\n')
        except Exception as e:
            print(e)
            exit()






